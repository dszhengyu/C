;THIS PROGRAM HAS OVERFLOW PROBLEM
;IS THIS PRO SHOULD BE inSTALL AS A INTERRUPT?????
ASSUME CS:CODE, SS:STACK

STACK SEGMENT
	DW 64 DUP(0)
STACK ENDS

S SEGMENT
	DW 128 DUP (0)
S ENDS

CODE SEGMENT
START:
	MOV AX, S
	MOV DS, AX
	MOV SI, 0
	MOV AX, STACK
	MOV SS, AX
	MOV SP, 128

	CALL GETSTR

	MOV AX, 4C00H
	INT 21H
	
GETSTR:
	MOV AH, 0
	INT 16H
	CMP AL, 20H
	JB KEY
	MOV AH, 0
	CALL CHARSTACK
	MOV AH, 2
	CALL CHARSTACK
	JMP GETSTR
KEY:
	CMP AH, 0EH
	JE BACKSPACE
	CMP AH, 1CH
	JE ENTERKEY
	JMP STRRET
BACKSPACE:
	MOV AH, 1
	CALL CHARSTACK
	MOV AH, 2
	CALL CHARSTACK
	JMP GETSTR
ENTERKEY:
	MOV AL, 0
	MOV AH, 0
	CALL CHARSTACK
	MOV AH, 2
	CALL CHARSTACK
STRRET:
	RET
	
	
	
CHARSTACK:
	JMP SHORT CHARSTART
TABLE DW CHARPUSH, CHARPOP, CHARSHOW
TOP DW 0
CHARSTART:
	PUSH BX
	PUSH ES
	PUSH DI
	PUSH CX
	
	CMP AL, 2
	JA CHARRET
	MOV BL, AH
	MOV BH, 0
	ADD BX, BX
	CALL WORD PTR TABLE[BX]
	
CHARRET:
	POP CX
	POP DI
	POP ES
	POP BX
	RET

CHARPUSH:
	MOV BX, TOP
	MOV [SI + BX], AL
	INC TOP
	RET

CHARPOP:
	CMP TOP, 0
	JE POPRET
	DEC TOP
	MOV BX, TOP
	MOV AL, [SI][BX]
POPRET:
	RET
	
CHARSHOW:
	MOV AX, 0B800H
	MOV ES, AX
	MOV AX, 160
	MUL DH
	MOV DI, AX
	ADD DL, DL
	MOV DH, 0
	ADD DI, DX
	MOV BX, 0
SHOWS:
	CMP BX, TOP
	JNE CONTINUE
	MOV BYTE PTR ES:[DI], ' '
	JMP SHOWRET
CONTINUE:
	MOV AL, [BX + SI]
	MOV ES:[DI], AL
	MOV BYTE PTR ES:[DI + 2], ' '
	ADD DI, 2
	INC BX
	JMP SHOWS
SHOWRET:
	RET
	
	
CODE ENDS
END START
